<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EasyLife Payment Voucher</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Base Reset & Mobile Optimization */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, Arial, sans-serif; }
        
        body { 
            background: #f0f2f5; 
            min-height: 100vh; 
            display: flex; 
            justify-content: center; 
            padding: 10px;
            color: #333;
        }

        /* Responsive Container */
        .container { 
            background: white; 
            width: 100%; 
            max-width: 900px; 
            border-radius: 12px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
            display: none; 
            overflow: hidden;
            margin-bottom: 20px;
        }

        /* Auto-Aligning Header */
        .header { 
            background: #06402B; 
            color: #FFFF00; 
            padding: 20px 15px; 
            text-align: center; 
            border-bottom: 5px solid #FFFF00; 
        }
        .header h1 { font-size: clamp(1.2rem, 5vw, 1.8rem); margin-bottom: 5px; }
        .branch-display { color: #fff; font-size: 0.9rem; letter-spacing: 1px; }

        /* THE AUTO-ALIGN GRID */
        .form-container { 
            padding: 20px; 
            display: flex;
            flex-wrap: wrap; /* This handles the auto-alignment */
            gap: 15px; 
        }

        .form-group { 
            flex: 1 1 calc(50% - 15px); /* Default 2 columns */
            display: flex; 
            flex-direction: column; 
            min-width: 280px; /* Forces stack on narrow screens */
        }

        .full-width { flex: 1 1 100% !important; }

        /* Labels & Inputs */
        label { 
            font-size: 0.75rem; 
            font-weight: 700; 
            color: #555; 
            margin-bottom: 6px; 
            display: flex; 
            justify-content: space-between;
        }

        input, select, textarea { 
            padding: 12px; 
            border: 1px solid #ced4da; 
            border-radius: 6px; 
            font-size: 16px; /* 16px prevents iOS zoom-in */
            width: 100%;
            transition: border-color 0.2s;
        }

        input:focus, select:focus { border-color: #06402B; outline: none; background: #f9fffb; }
        input[readonly] { background: #e9ecef; font-weight: bold; color: #27ae60; }

        /* Button Section */
        .button-area { 
            width: 100%; 
            padding: 20px; 
            text-align: center; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 15px;
        }
        
        .btn-gen { 
            background: #27ae60; 
            color: white; 
            border: none; 
            padding: 18px; 
            border-radius: 8px; 
            width: 100%; 
            max-width: 400px; 
            font-size: 1.1rem; 
            font-weight: bold; 
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3);
        }

        .reset-link { color: #007bff; cursor: pointer; text-decoration: none; font-size: 10px; }

        /* Login Overlay */
        #loginOverlay { position: fixed; inset: 0; background: #06402B; display: flex; justify-content: center; align-items: center; z-index: 1000; padding: 20px; }
        .login-box { background: white; padding: 30px; border-radius: 15px; width: 100%; max-width: 380px; text-align: center; }
        .login-box input, .login-box select { margin-bottom: 15px; }

        /* Mobile Specific Tweaks */
        @media (max-width: 480px) {
            .container { border-radius: 0; }
            body { padding: 0; }
            .form-container { padding: 15px; }
            .form-group { flex: 1 1 100%; } /* Strict single column on phones */
        }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <h2 style="color:#06402B; margin-bottom:20px;">EasyLife Login</h2>
            <select id="loginBranch"></select>
            <input type="password" id="loginPass" placeholder="Branch Password">
            <button onclick="handleLogin()" style="background:#27ae60; color:white; border:none; width:100%; padding:15px; border-radius:8px; font-weight:bold; cursor:pointer;">Enter Portal</button>
            <p id="errorMsg" style="color:red; display:none; margin-top:10px;">Invalid Credentials</p>
        </div>
    </div>

    <div class="container" id="mainApp">
        <div class="header">
            <h1>PAYMENT VOUCHER</h1>
            <div class="branch-display">LOCATION: <span id="currentBranch"></span></div>
        </div>

        <form id="voucherForm" class="form-container">
            <div class="form-group">
                <label>Voucher SL.No: <span class="reset-link" onclick="resetCounter()">[Reset]</span></label>
                <input type="text" id="voucherNo" readonly>
            </div>
            <div class="form-group">
                <label>Date:</label>
                <input type="date" id="date">
            </div>

            <div class="form-group">
                <label>Vendor Bill No:</label>
                <input type="text" id="vBillNo" placeholder="Bill #">
            </div>
            <div class="form-group">
                <label>Vendor Bill Date:</label>
                <input type="date" id="vBillDate">
            </div>

            <div class="form-group">
                <label>Tally Voucher No:</label>
                <input type="text" id="tallyNo" placeholder="Tally #">
            </div>
            <div class="form-group">
                <label>Tally Voucher Date:</label>
                <input type="date" id="tallyDate">
            </div>

            <div class="form-group">
                <label>Division:</label>
                <select id="division">
                    <option value="" disabled selected>-- Select --</option>
                    <option value="ELE">ELE</option>
                    <option value="GK">GK</option>
                    <option value="ELS">ELS</option>
                </select>
            </div>
            <div class="form-group">
                <label>Payee Name:</label>
                <input type="text" id="payee" placeholder="Full Name" oninput="this.value = this.value.toUpperCase();">
            </div>

            <div class="form-group full-width">
                <label>Contact Number:</label>
                <input type="tel" id="contact" placeholder="10-digit mobile" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
            </div>

            <div class="form-group full-width">
                <label>Payment Amount (â‚¹):</label>
                <input type="text" id="amount" oninput="updateAmountInWords()" placeholder="0.00">
            </div>

            <div class="form-group full-width">
                <label>Amount In Words:</label>
                <input type="text" id="amountWord" readonly>
            </div>

            <div class="form-group">
                <label>Payment Method:</label>
                <select id="method">
                    <option value="" disabled selected>-- Select --</option>
                    <option value="Cash">Cash</option>
                    <option value="Cheque">Cheque</option>
                    <option value="Bank Transfer">Bank Transfer</option>
                </select>
            </div>
            <div class="form-group">
                <label>Ref/UTR No:</label>
                <input type="text" id="refNo" placeholder="Reference #">
            </div>

            <div class="form-group full-width">
                <label>Payment Date:</label>
                <input type="date" id="payDate">
            </div>

            <div class="form-group full-width">
                <label>Purpose:</label>
                <select id="Purpose">
                    <option value="" disabled selected>-- Select Purpose --</option>
                    <option value="Advance">Advance</option>
                    <option value="Expenses">Expenses</option>
                    <option value="Purchase">Purchase</option>
                    <option value="Others">Others</option>
                </select>
            </div>

            <div class="form-group full-width">
                <label>Comments (Optional):</label>
                <textarea id="comments" rows="2"></textarea>
            </div>

            <div class="form-group">
                <label>Originator:</label>
                <input type="text" id="origName" oninput="this.value = this.value.toUpperCase();">
            </div>
            <div class="form-group">
                <label>Checker:</label>
                <input type="text" id="checkName" oninput="this.value = this.value.toUpperCase();">
            </div>

            <div class="button-area">
                <button type="button" class="btn-gen" onclick="generatePDF()">GENERATE PDF</button>
                <a href="#" onclick="logout()" style="color:#888; text-decoration:none; font-size:12px;">Switch Branch / Logout</a>
            </div>
        </form>
    </div>

    <script>
        const branchCredentials = {
            "Banavasi": "ELE@BNS2026", "Sirsi": "ELE@SIR2026", "Siddapura": "ELE@SID2026",
            "Mundagod": "ELE@MUD2026", "Haliyala": "ELE@HAL2026", "Yellapura": "ELE@YEL2026",
            "Honnavara": "ELE@HON2026", "Kumta": "ELE@KUM2026", "Bhatkal": "ELE@BHA2026",
            "Hoskote": "ELE@HOS2026", "Padubidire": "ELE@PAD2026", "Udupi": "ELE@UDU2026",
            "Hiriadka": "ELE@HIR2026", "Kundapura": "ELE@KUN2026", "Hebri": "ELE@HEB2026",
            "Bajagoli": "ELE@BAJ2026", "Ajekar": "ELE@AJE2026", "Hosmar": "ELE@HOSM2026",
            "Karkala": "ELE@KAR2026", "Koppa": "ELE@KOP2026", "Kalasa": "ELE@KAL2026",
            "N R Pura": "ELE@NRP2026", "Mudigere": "ELE@MUDI2026", "Chikamagauru": "ELE@CHK2026",
            "Thirthahalli": "ELE@THI2026", "Sagara": "ELE@SAG2026", "Hosanagara": "ELE@HOSA2026",
            "Soraba": "ELE@SOR2026", "Shikaripura": "ELE@SHI2026", "Shimoga": "ELE@SHIV2026",
            "Dhoti Point": "ELE@DHO2026", "Kadur": "ELE@KAD2026", "Belman": "ELE@BEL2026",
            "Byndoor": "ELE@BYN2026", "Chikamagauru Sonalika": "ELE@SONL2026", "HO": "ELE@HO2026"
        };

        const branchSelect = document.getElementById('loginBranch');
        branchSelect.innerHTML = '<option value="" disabled selected>-- Select Your Branch --</option>';
        Object.keys(branchCredentials).sort().forEach(b => {
            const opt = document.createElement('option');
            opt.value = b; opt.textContent = b; branchSelect.appendChild(opt);
        });

        function handleLogin() {
            const branch = branchSelect.value;
            const passInput = document.getElementById('loginPass').value;
            if (branch && passInput === branchCredentials[branch]) {
                localStorage.setItem('activeBranch', branch);
                checkAuth();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }

        function checkAuth() {
            const branch = localStorage.getItem('activeBranch');
            if (branch) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('currentBranch').innerText = branch.toUpperCase();
                initializeVoucherNo();
            }
        }

        function logout() { localStorage.removeItem('activeBranch'); location.reload(); }

        window.onload = function() {
            checkAuth();
            const today = new Date().toISOString().split('T')[0];
            document.querySelectorAll('input[type="date"]').forEach(el => el.value = today);
        };

        function initializeVoucherNo() {
            const branch = localStorage.getItem('activeBranch');
            let lastNo = localStorage.getItem('vNo_' + branch);
            document.getElementById('voucherNo').value = (lastNo ? parseInt(lastNo) + 1 : 1).toString().padStart(2, '0');
        }

        function resetCounter() {
            const branch = localStorage.getItem('activeBranch');
            if(confirm(`Reset SL.No for ${branch}?`)) {
                localStorage.removeItem('vNo_' + branch);
                initializeVoucherNo();
            }
        }

        function formatIndianCurrency(numStr) {
            let x = numStr.replace(/,/g, '');
            if (isNaN(x) || x === "") return "";
            let lastThree = x.substring(x.length - 3);
            let otherNumbers = x.substring(0, x.length - 3);
            if (otherNumbers != '') lastThree = ',' + lastThree;
            return otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + lastThree;
        }

        function numberToWordsIndian(num) {
            const a = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const convert = (n) => {
                if (n < 20) return a[n];
                if (n < 100) return b[Math.floor(n / 10)] + (n % 10 !== 0 ? " " + a[n % 10] : "");
                if (n < 1000) return a[Math.floor(n / 100)] + " Hundred" + (n % 100 !== 0 ? " " + convert(n % 100) : "");
                return "";
            };
            let str = "";
            if (num >= 10000000) { str += convert(Math.floor(num / 10000000)) + " Crore "; num %= 10000000; }
            if (num >= 100000) { str += convert(Math.floor(num / 100000)) + " Lakh "; num %= 100000; }
            if (num >= 1000) { str += convert(Math.floor(num / 1000)) + " Thousand "; num %= 1000; }
            str += convert(num);
            return str.trim() || "Zero";
        }

        function updateAmountInWords() {
            let amtInput = document.getElementById('amount');
            let rawVal = amtInput.value.replace(/,/g, '');
            let numeric = parseInt(rawVal);
            if (isNaN(numeric) || numeric < 0) { document.getElementById('amountWord').value = ""; return; }
            amtInput.value = formatIndianCurrency(rawVal);
            document.getElementById('amountWord').value = numeric === 0 ? "Zero Only" : numberToWordsIndian(numeric) + " Only";
        }

        function generatePDF() {
            const vNo = document.getElementById('voucherNo').value;
            const branch = localStorage.getItem('activeBranch');
            localStorage.setItem('vNo_' + branch, vNo);

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            const pageWidth = 210, margin = 10, contentW = 190;
            let y = 15;

            const drawField = (x, y, w, h, label, value, pct = 0.5) => {
                const lw = w * pct;
                doc.setDrawColor(0); doc.setLineWidth(0.4);
                doc.setFillColor(210, 210, 210); doc.rect(x, y, lw, h, 'FD'); 
                doc.setFillColor(255, 255, 255); doc.rect(x + lw, y, w - lw, h, 'FD'); 
                doc.setFont("helvetica", "bold"); doc.setFontSize(9);
                doc.text(label, x + (lw/2), y + (h/2) + 1.2, { align: "center" });
                doc.setFont("helvetica", "normal"); doc.setFontSize(8.5);
                doc.text(value ? value.toString() : "", x + lw + ((w - lw)/2), y + (h/2) + 1.2, { align: "center" });
            };

            doc.setDrawColor(0); doc.setLineWidth(0.5); doc.rect(5, 5, 200, 287); 
            doc.setFont("helvetica", "bold"); doc.setFontSize(10);
            doc.text("BRANCH: " + branch.toUpperCase(), margin, y - 5);

            doc.setFillColor(230, 230, 230); doc.rect(margin, y, contentW, 10, 'FD');
            doc.setFont("helvetica", "bold"); doc.setFontSize(14);
            doc.text("PAYMENT VOUCHER", pageWidth/2, y + 7, { align: "center" });
            y += 20;

            const formatDate = (d) => d ? d.split('-').reverse().join('-') : "";
            drawField(margin, y, 80, 10, "Voucher SL.No:", vNo, 0.5);
            drawField(margin + 123, y, 67, 10, "Date :", formatDate(document.getElementById('date').value), 0.4);
            y += 15;

            const gy = y;
            const detL = [
                ["Vendor Bill No:", document.getElementById('vBillNo').value], 
                ["Vendor Bill Date:", formatDate(document.getElementById('vBillDate').value)], 
                ["Tally Voucher No:", document.getElementById('tallyNo').value], 
                ["Tally Voucher Date:", formatDate(document.getElementById('tallyDate').value)]
            ];
            detL.forEach((r, i) => drawField(margin, gy + (i*10), 80, 10, r[0], r[1], 0.5));
            const detR = [
                ["Division:", document.getElementById('division').value || ""], 
                ["Payee Name:", document.getElementById('payee').value], 
                ["Contact:", document.getElementById('contact').value]
            ];
            detR.forEach((r, i) => drawField(margin + 123, gy + (i*10), 67, 10, r[0], r[1], 0.58));
            y = gy + 45;

            drawField(margin, y, contentW, 10, "Payment Amount:", document.getElementById('amount').value, 0.23);
            y += 10;
            drawField(margin, y, contentW, 10, "Amount In Word:", document.getElementById('amountWord').value, 0.23);
            y += 15;

            drawField(margin, y, 95, 20, "Payment Method:", document.getElementById('method').value || "", 0.45);
            drawField(margin + 110, y, 80, 10, "Reference No:", document.getElementById('refNo').value, 0.6);
            drawField(margin + 110, y + 10, 80, 10, "Payment Date:", formatDate(document.getElementById('payDate').value), 0.6);
            y += 25; 

            const purposeText = document.getElementById('Purpose').value;
            drawField(margin, y, contentW, 10, "Purpose:", purposeText, 0.23);
            y += 12;
            drawField(margin, y, contentW, 10, "COMMENTS:", document.getElementById('comments').value, 0.23);
            y += 20;

            const colW = contentW / 3;
            const sigs = [
                {l: "Originator", n: document.getElementById('origName').value}, 
                {l: "Checked By", n: document.getElementById('checkName').value}, 
                {l: "Authorised Sign", n: ""}
            ];
            sigs.forEach((sig, i) => {
                const sx = margin + (i * colW);
                doc.setFillColor(210, 210, 210); doc.rect(sx, y, colW, 10, 'FD');
                doc.setFont("helvetica", "bold"); doc.text(sig.l, sx + (colW / 2), y + 6.5, { align: "center" });
                doc.setFillColor(255, 255, 255); doc.rect(sx, y + 10, colW, 12, 'FD');
                doc.setFont("helvetica", "normal"); doc.text(sig.n, sx + (colW / 2), y + 17.5, { align: "center" });
            });

            doc.save(`Voucher_${vNo}_${branch}.pdf`);
            initializeVoucherNo();
        }
    </script>
</body>
</html>
