<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyLife Payment Voucher Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; }
        
        body { 
            background: #e0e0e0; 
            min-height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 10px;
        }

        .container { 
            background: white; 
            border-radius: 8px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); 
            width: 100%; 
            max-width: 950px; 
            overflow: hidden; 
        }

        .header { 
            background: #06402B; 
            color: #FFFF00; 
            padding: 20px 15px; 
            text-align: center; 
        }

        .header h1 { font-size: 1.5rem; }

        .form-container { 
            padding: 20px; 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            background: #f5f5f5; 
        }

        @media (max-width: 768px) {
            .form-container { grid-template-columns: 1fr; padding: 15px; }
            .full-width { grid-column: span 1 !important; }
            .buttons { grid-column: span 1 !important; }
        }

        .full-width { grid-column: span 2; }
        
        .form-group { display: flex; flex-direction: column; }
        
        .form-group label { 
            font-size: 0.75rem; 
            font-weight: 700; 
            color: #444; 
            margin-bottom: 4px; 
            text-transform: uppercase;
        }

        .form-group input, 
        .form-group select, 
        .form-group textarea { 
            padding: 12px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            font-size: 14px; 
            background: white; 
            width: 100%;
        }

        .form-group input[readonly] { 
            background: #e9ecef; 
            cursor: not-allowed; 
            font-weight: bold; 
            color: #27ae60; 
        }

        .buttons { 
            grid-column: span 2; 
            text-align: center; 
            padding-top: 10px; 
        }

        .btn { 
            padding: 15px 30px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: bold; 
            transition: 0.2s; 
            font-size: 16px; 
            width: 100%; 
            max-width: 300px;
        }

        .btn-gen { background: #27ae60; color: white; }
        .btn-gen:hover { background: #219150; }

        .sub-label { margin-top: 12px; }
        
        .reset-link {
            text-transform: none;
            font-weight: normal;
            color: #007bff;
            cursor: pointer;
            float: right;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header"><h1>Payment Voucher</h1></div>
        <form id="voucherForm" class="form-container">
            
            <div class="form-group">
                <label>Voucher SL.No: <span class="reset-link" onclick="resetCounter()">Reset No.</span></label>
                <input type="text" id="voucherNo" readonly>
            </div>
            <div class="form-group">
                <label>Date:</label>
                <input type="date" id="date">
            </div>

            <div class="form-group">
                <label>Vender Bill No:</label>
                <input type="text" id="vBillNo" placeholder="Bill Number">
                
                <label class="sub-label">Vender Bill Date:</label>
                <input type="date" id="vBillDate">
                
                <label class="sub-label">Tally voucher No:</label>
                <input type="text" id="tallyNo" placeholder="Tally Number">
                
                <label class="sub-label">Tally voucher Date:</label>
                <input type="date" id="tallyDate">
            </div>

            <div class="form-group">
                <label>Division:</label>
                <select id="division">
                    <option value="" selected disabled>--Select Division--</option>
                    <option value="ELE">ELE</option>
                    <option value="GK">GK</option>
                    <option value="ELS">ELS</option>
                </select>
                
                <label class="sub-label">Payee Name:</label>
                <input type="text" id="payee" placeholder="Receiver Name" oninput="this.value = this.value.toUpperCase();">
                
                <label class="sub-label">Contact:</label>
                <input type="text" id="contact" placeholder="Mobile Number" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
            </div>

            <div class="form-group full-width">
                <label>Payment Amount:</label>
                <input type="text" id="amount" oninput="updateAmountInWords()" placeholder="Enter Amount">
            </div>
            <div class="form-group full-width">
                <label>Amount In Word:</label>
                <input type="text" id="amountWord" readonly placeholder="Calculated automatically...">
            </div>

            <div class="form-group">
                <label>Payment Method:</label>
                <select id="method">
                    <option value="" selected disabled>--Select Payment--</option>
                    <option value="Cash">Cash</option>
                    <option value="Cheque">Cheque</option>
                    <option value="Bank Transfer">Bank Transfer</option>
                </select>
            </div>
            <div class="form-group">
                <label>Reference No:</label>
                <input type="text" id="refNo" placeholder="UTR / Ref No.">
                
                <label class="sub-label">Payment Date:</label>
                <input type="date" id="payDate">
            </div>

            <div class="form-group full-width">
                <label>Purpose:</label>
                <select id="Purpose">
                    <option value="" selected disabled>--Select Purpose--</option>
                    <option value="Advance">Advance</option>
                    <option value="Expenses">Expenses</option>
                    <option value="Purchase">Purchase</option>
                    <option value="Others">Others</option>
                </select>
            </div>
            <div class="form-group full-width">
                <label>COMMENTS (If Any):</label>
                <textarea id="comments" rows="3" placeholder="Enter comments..."></textarea>
            </div>

            <div class="form-group">
                <label>Originator Name:</label>
                <input type="text" id="origName" placeholder="Enter Name" oninput="this.value = this.value.toUpperCase();">
            </div>

            <div class="form-group">
                <label>Checker Name:</label>
                <input type="text" id="checkName" placeholder="Enter Name" oninput="this.value = this.value.toUpperCase();">
            </div>

            <div class="buttons">
                <button type="button" class="btn btn-gen" onclick="generatePDF()">Generate Voucher PDF</button>
            </div>
        </form>
    </div>

    <script>
        // ON LOAD INITIALIZATION
        window.onload = function() {
            // Set default dates to today
            const today = new Date().toISOString().split('T')[0];
            document.querySelectorAll('input[type="date"]').forEach(el => el.value = today);

            // Handle Serial Number
            initializeVoucherNo();
        };

        function initializeVoucherNo() {
            let lastNo = localStorage.getItem('lastVoucherNo');
            if (!lastNo) {
                lastNo = 0; // Starting number
            }
            document.getElementById('voucherNo').value = parseInt(lastNo) + 1;
        }

        function resetCounter() {
            if(confirm("Reset serial number to 1001?")) {
                localStorage.removeItem('lastVoucherNo');
                initializeVoucherNo();
            }
        }

        // CURRENCY FORMATTING
        function formatIndianCurrency(numStr) {
            let x = numStr.replace(/,/g, '');
            if (isNaN(x) || x === "") return "";
            let lastThree = x.substring(x.length - 3);
            let otherNumbers = x.substring(0, x.length - 3);
            if (otherNumbers != '') lastThree = ',' + lastThree;
            return otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + lastThree;
        }

        function numberToWordsIndian(num) {
            const a = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            if (num === 0) return "Zero";
            const convert = (n) => {
                if (n < 20) return a[n];
                if (n < 100) return b[Math.floor(n / 10)] + (n % 10 !== 0 ? " " + a[n % 10] : "");
                if (n < 1000) return a[Math.floor(n / 100)] + " Hundred" + (n % 100 !== 0 ? " " + convert(n % 100) : "");
                return "";
            };
            let str = "";
            if (num >= 10000000) { str += convert(Math.floor(num / 10000000)) + " Crore "; num %= 10000000; }
            if (num >= 100000) { str += convert(Math.floor(num / 100000)) + " Lakh "; num %= 100000; }
            if (num >= 1000) { str += convert(Math.floor(num / 1000)) + " Thousand "; num %= 1000; }
            str += convert(num);
            return str.trim();
        }

        function updateAmountInWords() {
            let amtInput = document.getElementById('amount');
            let rawVal = amtInput.value.replace(/,/g, '');
            let numeric = parseInt(rawVal);
            if (isNaN(numeric) || numeric < 0) { document.getElementById('amountWord').value = ""; return; }
            amtInput.value = formatIndianCurrency(rawVal);
            document.getElementById('amountWord').value = numeric === 0 ? "Zero Only" : numberToWordsIndian(numeric) + " Only";
        }

        // PDF GENERATION
        function generatePDF() {
            const voucherNo = document.getElementById('voucherNo').value;
            
            // Save the current number to local storage so next time it increments
            localStorage.setItem('lastVoucherNo', voucherNo);

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            const pageWidth = 210, margin = 10, contentW = 190;
            let y = 15;

            const drawField = (x, y, w, h, label, value, pct = 0.5) => {
                const lw = w * pct;
                doc.setDrawColor(0); doc.setLineWidth(0.4);
                doc.setFillColor(210, 210, 210); doc.rect(x, y, lw, h, 'FD'); 
                doc.setFillColor(255, 255, 255); doc.rect(x + lw, y, w - lw, h, 'FD'); 
                doc.setFont("helvetica", "bold"); doc.setFontSize(9);
                doc.text(label, x + (lw/2), y + (h/2) + 1.2, { align: "center" });
                doc.setFont("helvetica", "normal"); doc.setFontSize(8.5);
                doc.text(value.toString(), x + lw + ((w - lw)/2), y + (h/2) + 1.2, { align: "center" });
            };

            doc.setDrawColor(0); doc.setLineWidth(0.5); doc.rect(5, 5, 200, 287); 

            doc.setFillColor(230, 230, 230); doc.rect(margin, y, contentW, 10, 'FD');
            doc.setFont("helvetica", "bold"); doc.setFontSize(14);
            doc.text("PAYMENT VOUCHER", pageWidth/2, y + 7, { align: "center" });
            y += 20;

            const formatDate = (d) => d ? d.split('-').reverse().join('-') : "";

            drawField(margin, y, 80, 10, "Voucher SL.No:", voucherNo, 0.5);
            drawField(margin + 123, y, 67, 10, "Date :", formatDate(document.getElementById('date').value), 0.4);
            y += 15;

            const gy = y;
            const detL = [
                ["Vender Bill No :", document.getElementById('vBillNo').value], 
                ["Vender Bill Date :", formatDate(document.getElementById('vBillDate').value)], 
                ["Tally voucher No :", document.getElementById('tallyNo').value], 
                ["Tally voucher Date :", formatDate(document.getElementById('tallyDate').value)]
            ];
            detL.forEach((r, i) => drawField(margin, gy + (i*10), 80, 10, r[0], r[1], 0.5));
            
            const detR = [
                ["Division :", document.getElementById('division').value || ""], 
                ["Payee Name :", document.getElementById('payee').value], 
                ["Contact :", document.getElementById('contact').value]
            ];
            detR.forEach((r, i) => drawField(margin + 123, gy + (i*10), 67, 10, r[0], r[1], 0.58));
            y = gy + 45;

            drawField(margin, y, contentW, 10, "Payment Amount :", document.getElementById('amount').value, 0.23);
            y += 10;
            drawField(margin, y, contentW, 10, "Amount In Word :", document.getElementById('amountWord').value, 0.23);
            y += 15;

            drawField(margin, y, 95, 20, "Payment Method :", document.getElementById('method').value || "", 0.45);
            drawField(margin + 110, y, 80, 10, "Payment Reference No :", document.getElementById('refNo').value, 0.6);
            drawField(margin + 110, y + 10, 80, 10, "Payment Date:", formatDate(document.getElementById('payDate').value), 0.6);
            
            y += 25; 

            const pObj = document.getElementById('Purpose');
            const purposeText = pObj.selectedIndex > 0 ? pObj.options[pObj.selectedIndex].text : "";
            drawField(margin, y, contentW, 10, "Purpose :", purposeText, 0.23);
            y += 12;
            drawField(margin, y, contentW, 10, "COMMENTS( IF Any)", document.getElementById('comments').value, 0.23);
            y += 20;

            const colW = contentW / 3;
            const hH = 10, bH = 12;
            const sigs = [
                {l: "Originator", n: document.getElementById('origName').value}, 
                {l: "Checked By", n: document.getElementById('checkName').value}, 
                {l: "Authorised Sign", n: ""}
            ];
            sigs.forEach((sig, i) => {
                const sx = margin + (i * colW);
                doc.setFillColor(210, 210, 210); doc.rect(sx, y, colW, hH, 'FD');
                doc.setFont("helvetica", "bold"); doc.text(sig.l, sx + (colW / 2), y + 6.5, { align: "center" });
                doc.setFillColor(255, 255, 255); doc.rect(sx, y + hH, colW, bH, 'FD');
                doc.setFont("helvetica", "normal"); doc.text(sig.n, sx + (colW / 2), y + hH + 7.5, { align: "center" });
            });

            doc.save(`Voucher_${voucherNo}.pdf`);
            
            // Increment the number for the next one immediately after saving
            initializeVoucherNo();
        }
    </script>
</body>
</html>